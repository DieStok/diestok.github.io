---
title: 'Journal Club #1 : CODE-AE'
date: 2024-07-08
permalink: /posts/2013/08/blog-post-2/
#bibliography: /Users/dstoker/surfdrive/LiteratureFile/My\ Library.bib
tags:
  - autoencoder
  - GAN
  - drug prediction
  - shared latent spaces
---

# Journal Club #1: CODE-AE

Reference: He, D., Liu, Q., Wu, Y., & Xie, L. (2022). A context-aware deconfounding autoencoder for robust prediction of personalized clinical drug response from cell-line compound screening. Nature Machine Intelligence, 4(10), 879-892.

## Recommended related papers
- [Mourragui, S., Loog, M., Van De Wiel, M. A., Reinders, M. J., & Wessels, L. F. (2019). PRECISE: a domain adaptation approach to transfer predictors of drug response from pre-clinical models to tumors. Bioinformatics, 35(14), i510-i519.](https://academic.oup.com/bioinformatics/article/35/14/i510/5529136?login=true) : uses PDX models, cell line(drug response)s, and tumors data to predict drug response in tumors based on pre-clinical data. Early, linear method, similar to PCA (though finding linear shared directions of variation between pre-clinical model expression and tumor expression, rather than axes of most variance).
- [Mourragui, S. M., Siefert, J. C., Reinders, M. J., Loog, M., & Wessels, L. F. (2022). Identifying commonalities between cell lines and tumors at the single cell level using Sobolev Alignment of deep generative models. bioRxiv, 2022-03.](https://www.biorxiv.org/content/10.1101/2022.03.08.483431v1.abstract) : uses single-cell generative models and [kernel machines](https://www.youtube.com/watch?v=ABOEE3ThPGQ) to overlay single-cell gene expression data and PDX expression and drug response data for drug response prediction. Very similar in goals, though with per-gene attribution scores, and perhaps more elegant. 
- [The GeneFormer paper: Transfer learning enables predictions in network biology](https://www.nature.com/articles/s41586-023-06139-9). Focuses only on single-cell expression data. Large pre-trained scexpression foundation model trained using masked gene rank predictions (like BERT). The authors find drug target candidates (i.e. candidate genes) by asking what shifts the embedding of healthy subjects to diseased subjects for hyperthropic and dilated cardiomyopathy. This analysis of drug targets is not so much transfer learning as it is a sort of in-silico modeling in learned embedding spaces.

## **TL;DR**
* The what: a combination of three autoencoders, trained on in vitro cell-line expression data with coupled drug screen data (Cancer Cell Line Encyclopedia: [CCLE](https://depmap.org/portal/ccle/)), and tissue expression data (The Cancer Genome Atlas: [TCGA](https://www.cancer.gov/ccg/research/genome-sequencing/tcga)). The goal: transfer learning to predict tissue drug response from known cell-line drug response.
* The aim: to align the biological variation in cell lines that and the (much more complex and multifactorial) biological variation in tissues. The signal is thus split up into overlapping biological variation, that can be used to predict tissue drug response from cell-line drug response, and in vitro cell-line-specific and tissue-specific processes, i.e. the part of variation where cell lines don’t model tissues well.
* The method: train two autoencoders to encode cell-line and tissue expression (1,426 log-transformed TPM gene expression values taken into account). Call them $C_e$ and $T_e$. Now train one more autoencoder that is able to encode both tissue and cell-line expression data. Call it the shared encoder, $S_e$. The magic touch: besides normal reconstruction losses, force the encodings of the shared encoder and the two data-specific encoders to be different (i.e. define a loss term for their similarity, implemented with soft subspace orthogonality constraints). The upshot: now you can train a classifier on the encodings of the cell lines by $S_e$, and then apply it to the encodings of the tissue data to predict. For this a classifier neural network module is added on top of the encoder, and the whole (shared encoder + classifier) is fine-tuned on a per-drug basis (i.e. one model per drug, which may not scale well). Training here is on a binarization of area under the drug response curve (AUC) into responding and non-responding cell lines. Sensible predictions roll out. Note: there is some fiddling with pulling the data-specific and shared encodings together again after first training them to be separate, i.e. it didn’t work first try. The final model includes an adversarial loss (CODE-AE-ADV).
* The results: 
1.  t-SNE plots of CCLE (cells) and TCGA (tissues) expression data show nice overlap, in contrast to the original data and data encoded with a [vanilla autoencoder](https://avandekleut.github.io/vae/).
2. Preliminary test: can the confounder of sex be filtered out (later to be replaced by the confounder of in vitro cell-line versus tissue expression)? Answer: yes, predicting TCGA brain cancer subtype for males when trained only on female expression data and vice versa is very effective. The best exact set-up of the model here is called CODE-AE-ADV and used throughout.
3. OOD validation I (i.e. testing after model training):  tests on short-term cultures of PDTX-derived breast cancer cells screened for the effects of drugs (focused on 50 drugs that are also in (Genomics of Drug Sensitivity in Cancer (GDSC) database)[https://www.cancerrxgene.org/] ; using a binarisation cut-off of response (1) if the value of the area under the dose-response curve (AUC) for all cell lines tested with a drug in GDSC >= average AUC of all drugs tested, or non-response (0) if less than it. AU drug-response curve is a metric that one can use also when the number of doses measured is low.): CODE-AE-ADV outperforms other methods on a per-drug ranking. Note: this also means that CODE-AE-ADV is trained on a per-drug basis, which is not the most scalable solution (and disregards transferrable patterns in data for different drugs).
4. OOD validation II: predicting lack of response in chemotherapy treatment through either a. lack of reduction of tumour size after treatment or b. clinical relapse after initial positive response to treatment. Data used for a. was from a recent study on TCGA data chemotherapy response, for b. from the original TCGA data, with a split based on the median number of days until new tumor events (below: relapse, above: non-relapse). Note that this binarisation of time-to-event data is coarse-grained yet still offers some insight.
5. Investigation of predicted effectiveness of 59 drugs (59 versions of CODE-AE-ADV, one for each drug) for 9,808 cancer patients in TCGA. This is exploratory: do the learned drug effect representations generalise to the TCGA data; are sensible predictions made? To investigate, the authors either take top- and bottom-ranked drugs (based on predicted effectivness), or the extremes of calculated Z-scores. As a first sanity check, they show that predicted effectivness/ineffectiveness is associated with drug target expression (note that the model did not get the drug target in its training data). (Spectral biclustering)[https://people.csail.mit.edu/dsontag/courses/ml14/notes/Luxburg07_tutorial_spectral_clustering.pdf] (i.e. clustering based on both gene expression profile across patients as well as predicted drug effectivity into combined clusters that reflect both) was used to cluster into 100 patient groups and 30 drug groups (these numbers were not motivated in the paper). The authors zoom in on lung squamous cell carcinoma (LSCC). They show that among the group that has the highest (average) predicted sensitivity to gefinitib (a chemotherapy agent used for first-line treatment of non-squamous cell lung carcinoma (NSCLC), acting as a epidermal growth factor receptor (EGFR) tyrosine kinase inhibitor). Other cancer types that cluster together here are not usually treated with this drug, but clinical trials are underway for many of them, as subgroups of patients have shown responsiveness. This hints that CODE-AE-ADV has learned generalisable embeddings and predictive capabilities.
* The takeaways: finding aligned embedding spaces between different domains is booming business (think also of single-cell atlases, and multi-omics data where the different modalities are different 'domains'). Here, the combination of a tissue-only and cell-line only expression encoder with an encoder that needs to encode both forces a separation into three different latent subspaces: 1. one for tissue-specific expression patterns, 2. one for cell-line-specific expression patterns, and 3. one for shared expression patterns that can be used for predicting drug response for cancer (tissue) based on the response of cell lines. An interesting finding is that CODE-AE-ADV works best: they first separate signal into the separate subspaces, but then use a critic network (like a GAN) to make the concatenation of tissue private and tissue shared encoding similar to the concatenation of cell-line private and cell-line shared encoding. In essence: you pull the embeddings apart into shared and distinct parts, but then pull the concatenation of those separate parts together again. Why? I do not know. Perhaps otherwise the embeddings become too different and incomparable. It feels arbitrary and a bit fiddly, but I probably lack some key insight here.
As I said before, they do this on a per-drug basis, which becomes prohibitive as the number of drugs increases. All in all, really cool paper!

## Why should we care about this?

Before we begin, let's set the stage. We throw the term data deluge around willy-nilly in biology, but we are in one and it does have meaning. So what's going on? We now have 87 million-odd single cell sequencing results (for instance in [CellxGene](https://cellxgene.cziscience.com/) and a lot of bulk sequencing data (for instance in [GTEx](https://www.gtexportal.org/home/). At the same time, for many drugs we have effects and interactions in cell lines, but not in humans or bulk tissue. Ideally, we'd have some way of predicting directly from simple experimental screens whether a drug is likely to work in a patient, or even which drug would most benefit a patient given a panel of contenders (drug benefit prediction, which runs into the [counterfactual problem](https://www.nature.com/articles/s42256-020-0197-y): you do not have data on what would have happened, had you given the patient another drug. In fact, that data is unobtainable in baseline reality). 

## What else?

Besides Nespresso (thanks Clooney, very cool), a what else here is that I am not currently writing a long-form explanation of the TL;DR, but wanted to make my view on the basic results of this paper available.   



